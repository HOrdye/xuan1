<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤©ç„é¡¹ç›® - Debugæµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .error { color: red; }
        .success { color: green; }
        .warning { color: orange; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 3px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>å¤©ç„é¡¹ç›® - Debugæµ‹è¯•é¡µé¢</h1>
    
    <div class="test-section">
        <h2>ğŸ” è§£æå¤±è´¥é—®é¢˜è¯Šæ–­</h2>
        <p>è¿™ä¸ªé¡µé¢å°†å¸®åŠ©æˆ‘ä»¬æ‰¾åˆ°è§£æå¤±è´¥çš„å…·ä½“åŸå› </p>
        
        <button onclick="testBasicFunctionality()">æµ‹è¯•åŸºæœ¬åŠŸèƒ½</button>
        <button onclick="testFortuneGeneration()">æµ‹è¯•è¿åŠ¿ç”Ÿæˆ</button>
        <button onclick="testHexagramParsing()">æµ‹è¯•å¦è±¡è§£æ</button>
        <button onclick="testLLMService()">æµ‹è¯•LLMæœåŠ¡</button>
        <button onclick="clearResults()">æ¸…é™¤ç»“æœ</button>
        
        <div id="test-results"></div>
    </div>

    <script>
        // æµ‹è¯•ç»“æœæ˜¾ç¤ºåŒºåŸŸ
        const resultsDiv = document.getElementById('test-results');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : type === 'warning' ? 'warning' : '';
            resultsDiv.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            console.log(`[${timestamp}] ${message}`);
        }
        
        function clearResults() {
            resultsDiv.innerHTML = '';
        }
        
        // æµ‹è¯•åŸºæœ¬åŠŸèƒ½
        async function testBasicFunctionality() {
            log('å¼€å§‹æµ‹è¯•åŸºæœ¬åŠŸèƒ½...', 'info');
            
            try {
                // æµ‹è¯•æœ¬åœ°å­˜å‚¨
                localStorage.setItem('test_key', 'test_value');
                const retrieved = localStorage.getItem('test_key');
                if (retrieved === 'test_value') {
                    log('âœ… æœ¬åœ°å­˜å‚¨åŠŸèƒ½æ­£å¸¸', 'success');
                } else {
                    log('âŒ æœ¬åœ°å­˜å‚¨åŠŸèƒ½å¼‚å¸¸', 'error');
                }
                localStorage.removeItem('test_key');
                
                // æµ‹è¯•JSONè§£æ
                const testObj = { test: 'æµ‹è¯•æ•°æ®', number: 123 };
                const jsonStr = JSON.stringify(testObj);
                const parsed = JSON.parse(jsonStr);
                if (parsed.test === 'æµ‹è¯•æ•°æ®' && parsed.number === 123) {
                    log('âœ… JSONè§£æåŠŸèƒ½æ­£å¸¸', 'success');
                } else {
                    log('âŒ JSONè§£æåŠŸèƒ½å¼‚å¸¸', 'error');
                }
                
                // æµ‹è¯•æ—¥æœŸå¤„ç†
                const now = new Date();
                const dateStr = now.toISOString().split('T')[0];
                log(`âœ… æ—¥æœŸå¤„ç†æ­£å¸¸: ${dateStr}`, 'success');
                
            } catch (error) {
                log(`âŒ åŸºæœ¬åŠŸèƒ½æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // æµ‹è¯•è¿åŠ¿ç”Ÿæˆ
        async function testFortuneGeneration() {
            log('å¼€å§‹æµ‹è¯•è¿åŠ¿ç”Ÿæˆ...', 'info');
            
            try {
                // æ¨¡æ‹Ÿè¿åŠ¿æ•°æ®ç»“æ„
                const fortuneData = {
                    date: new Date().toISOString().split('T')[0],
                    energyScore: 75,
                    description: 'ä»Šæ—¥è¿åŠ¿ä¸é”™',
                    aspects: {
                        love: { score: 80, description: 'æ„Ÿæƒ…è¿åŠ¿è‰¯å¥½' },
                        career: { score: 70, description: 'äº‹ä¸šç¨³æ­¥å‘å±•' },
                        health: { score: 85, description: 'èº«ä½“å¥åº·' },
                        wealth: { score: 65, description: 'è´¢è¿ä¸€èˆ¬' }
                    }
                };
                
                // æµ‹è¯•æ•°æ®åºåˆ—åŒ–
                const serialized = JSON.stringify(fortuneData);
                const deserialized = JSON.parse(serialized);
                
                if (deserialized.energyScore === 75) {
                    log('âœ… è¿åŠ¿æ•°æ®åºåˆ—åŒ–æ­£å¸¸', 'success');
                } else {
                    log('âŒ è¿åŠ¿æ•°æ®åºåˆ—åŒ–å¼‚å¸¸', 'error');
                }
                
                // æµ‹è¯•æœ¬åœ°å­˜å‚¨è¿åŠ¿æ•°æ®
                const storageKey = `fortune_${fortuneData.date}`;
                localStorage.setItem(storageKey, serialized);
                const storedData = localStorage.getItem(storageKey);
                
                if (storedData) {
                    const parsedStored = JSON.parse(storedData);
                    if (parsedStored.energyScore === 75) {
                        log('âœ… è¿åŠ¿æ•°æ®å­˜å‚¨å’Œè¯»å–æ­£å¸¸', 'success');
                    } else {
                        log('âŒ è¿åŠ¿æ•°æ®å­˜å‚¨åè¯»å–å¼‚å¸¸', 'error');
                    }
                } else {
                    log('âŒ è¿åŠ¿æ•°æ®å­˜å‚¨å¤±è´¥', 'error');
                }
                
                localStorage.removeItem(storageKey);
                
            } catch (error) {
                log(`âŒ è¿åŠ¿ç”Ÿæˆæµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                log(`é”™è¯¯è¯¦æƒ…: ${error.stack}`, 'error');
            }
        }
        
        // æµ‹è¯•å¦è±¡è§£æ
        async function testHexagramParsing() {
            log('å¼€å§‹æµ‹è¯•å¦è±¡è§£æ...', 'info');
            
            try {
                // æ¨¡æ‹Ÿå¦è±¡æ•°æ®ç»“æ„
                const hexagramData = {
                    number: 1,
                    sequence: 1,
                    name: 'ä¹¾',
                    symbol: 'ä·€',
                    lines: [1, 1, 1, 1, 1, 1],
                    meaning: 'åˆšå¥ä¸­æ­£ï¼Œè‡ªå¼ºä¸æ¯',
                    judgment: 'å…ƒäº¨åˆ©è´',
                    yao_texts: [
                        'æ½œé¾™å‹¿ç”¨',
                        'è§é¾™åœ¨ç”°ï¼Œåˆ©è§å¤§äºº',
                        'å›å­ç»ˆæ—¥ä¹¾ä¹¾ï¼Œå¤•æƒ•è‹¥ï¼Œå‰æ— å’',
                        'æˆ–è·ƒåœ¨æ¸Šï¼Œæ— å’',
                        'é£é¾™åœ¨å¤©ï¼Œåˆ©è§å¤§äºº',
                        'äº¢é¾™æœ‰æ‚”'
                    ],
                    trigrams: { upper: 'Heaven', lower: 'Heaven' }
                };
                
                // æµ‹è¯•å¦è±¡æ•°æ®åºåˆ—åŒ–
                const serialized = JSON.stringify(hexagramData);
                const deserialized = JSON.parse(serialized);
                
                if (deserialized.number === 1 && deserialized.lines.length === 6) {
                    log('âœ… å¦è±¡æ•°æ®åºåˆ—åŒ–æ­£å¸¸', 'success');
                } else {
                    log('âŒ å¦è±¡æ•°æ®åºåˆ—åŒ–å¼‚å¸¸', 'error');
                }
                
                // æµ‹è¯•çˆ»ä½è®¡ç®—
                const binaryStr = hexagramData.lines.join('');
                if (binaryStr === '111111') {
                    log('âœ… çˆ»ä½è®¡ç®—æ­£å¸¸', 'success');
                } else {
                    log('âŒ çˆ»ä½è®¡ç®—å¼‚å¸¸', 'error');
                }
                
            } catch (error) {
                log(`âŒ å¦è±¡è§£ææµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                log(`é”™è¯¯è¯¦æƒ…: ${error.stack}`, 'error');
            }
        }
        
        // æµ‹è¯•LLMæœåŠ¡
        async function testLLMService() {
            log('å¼€å§‹æµ‹è¯•LLMæœåŠ¡é…ç½®...', 'info');
            
            try {
                // æµ‹è¯•é…ç½®æ•°æ®ç»“æ„
                const llmConfig = {
                    provider: 'qianwen',
                    apiKey: 'test_key',
                    baseURL: 'https://api.example.com',
                    model: 'qwen-turbo'
                };
                
                // æµ‹è¯•é…ç½®åºåˆ—åŒ–
                const serialized = JSON.stringify(llmConfig);
                const deserialized = JSON.parse(serialized);
                
                if (deserialized.provider === 'qianwen') {
                    log('âœ… LLMé…ç½®åºåˆ—åŒ–æ­£å¸¸', 'success');
                } else {
                    log('âŒ LLMé…ç½®åºåˆ—åŒ–å¼‚å¸¸', 'error');
                }
                
                // æµ‹è¯•é…ç½®å­˜å‚¨
                localStorage.setItem('llm_config', serialized);
                const storedConfig = localStorage.getItem('llm_config');
                
                if (storedConfig) {
                    const parsedConfig = JSON.parse(storedConfig);
                    if (parsedConfig.provider === 'qianwen') {
                        log('âœ… LLMé…ç½®å­˜å‚¨å’Œè¯»å–æ­£å¸¸', 'success');
                    } else {
                        log('âŒ LLMé…ç½®å­˜å‚¨åè¯»å–å¼‚å¸¸', 'error');
                    }
                } else {
                    log('âŒ LLMé…ç½®å­˜å‚¨å¤±è´¥', 'error');
                }
                
                localStorage.removeItem('llm_config');
                
            } catch (error) {
                log(`âŒ LLMæœåŠ¡æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                log(`é”™è¯¯è¯¦æƒ…: ${error.stack}`, 'error');
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡ŒåŸºæœ¬æµ‹è¯•
        window.addEventListener('load', function() {
            log('Debugæµ‹è¯•é¡µé¢å·²åŠ è½½', 'info');
            log('ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•å„é¡¹åŠŸèƒ½', 'info');
        });
        
        // æ•è·å…¨å±€é”™è¯¯
        window.addEventListener('error', function(event) {
            log(`âŒ å…¨å±€é”™è¯¯: ${event.error.message}`, 'error');
            log(`é”™è¯¯ä½ç½®: ${event.filename}:${event.lineno}:${event.colno}`, 'error');
        });
        
        // æ•è·æœªå¤„ç†çš„Promiseé”™è¯¯
        window.addEventListener('unhandledrejection', function(event) {
            log(`âŒ æœªå¤„ç†çš„Promiseé”™è¯¯: ${event.reason}`, 'error');
        });
    </script>
</body>
</html> 