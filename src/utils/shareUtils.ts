import type { ShareData, ShareContent, ShareContentType, SocialPlatform } from '../types/share';

// é»˜è®¤åˆ†äº«é…ç½®
export const DEFAULT_SHARE_CONFIG = {
  enableNativeShare: true,
  enableSocialPlatforms: true,
  defaultHashtags: ['å¤©ç„Web', 'ç„å­¦åŠ©æ‰‹', 'å åœæŒ‡å¼•'],
  captionTemplates: {
    fortune: [
      'åˆšåˆšåœ¨å¤©ç„Webè·å¾—äº†ä»Šæ—¥è¿åŠ¿è§£è¯»ï¼Œæ„Ÿè§‰å¾ˆå‡†å‘¢ï¼âœ¨ #ä»Šæ—¥è¿åŠ¿ #ç„å­¦åŠ©æ‰‹',
      'ä»Šå¤©çš„è¿åŠ¿åˆ†æè®©æˆ‘å¯¹æœªæ¥æ›´æœ‰ä¿¡å¿ƒäº† ğŸ’« #è¿åŠ¿ #æ­£èƒ½é‡',
      'åˆ†äº«ä¸€ä¸‹æˆ‘çš„ç„å­¦å°ç¡®å¹¸ï¼Œå¤©ç„WebçœŸçš„å¾ˆæœ‰æ„æ€ ğŸŒŸ #ç„å­¦ #æ—¥å¸¸åˆ†äº«'
    ],
    tarot: [
      'ğŸ”® é€šè¿‡å¡”ç½—å åœæ‰¾åˆ°äº†å†…å¿ƒæ·±å¤„çš„ç­”æ¡ˆï¼Œæ¯å¼ å¡ç‰Œéƒ½æœ‰ç‹¬ç‰¹çš„å¯ç¤º âœ¨ #å¡”ç½—å åœ #å¿ƒçµæˆé•¿',
      'âœ¨ å¡”ç½—ç‰Œç»™äº†æˆ‘å…³äºäººç”Ÿçš„æ·±åˆ»æ´å¯Ÿï¼Œæ­£ä½é€†ä½éƒ½æœ‰å…¶æ„ä¹‰ ğŸŒŸ #å¡”ç½—è§£è¯» #ç”Ÿæ´»æŒ‡å—',
      'ğŸ´ ä»Šå¤©çš„å¡”ç½—å åœè®©æˆ‘å¯¹å½“å‰å›°å¢ƒæœ‰äº†æ–°çš„ç†è§£ï¼Œæ„Ÿè°¢å®‡å®™çš„æŒ‡å¼• ğŸ’« #å¡”ç½—å åœ #ç„å­¦æ™ºæ…§',
      'ğŸŒŸ å¡”ç½—ç‰Œçš„è±¡å¾æ„ä¹‰çœŸçš„å¾ˆæ·±åˆ»ï¼Œæ¯æ¬¡å åœéƒ½èƒ½è·å¾—å»ºè®¾æ€§çš„å»ºè®® âœ¨ #å¡”ç½—ç‰Œ #å¿ƒçµæŒ‡å¼•',
      'ğŸ’¡ é€šè¿‡å¡”ç½—å åœè·å¾—äº†å…·ä½“çš„è¡ŒåŠ¨æ–¹å‘ï¼Œå¡ç‰Œçš„æ™ºæ…§ä»¤äººæƒŠå¹ ğŸ”® #å¡”ç½—å åœ #äººç”ŸæŒ‡å¯¼'
    ],
    jiaoBei: [
      'åœ¨å¤©ç„Webè¿›è¡Œäº†ç¬…æ¯å åœï¼Œè·å¾—äº†ç¥æ˜çš„æŒ‡å¼•ï¼ğŸ™ #ç¬…æ¯å åœ #ç¥æ˜æŒ‡å¼•',
      'ç¬…æ¯ç»™äº†æˆ‘æ¸…æ™°çš„æ–¹å‘ï¼Œæ„Ÿè°¢ç¥æ˜çš„åº‡ä½‘ âœ¨ #ç¬…æ¯ #ç¥ˆç¦',
      'é€šè¿‡ç¬…æ¯å åœå¾—åˆ°äº†é‡è¦çš„å¯ç¤º ğŸŒŸ #ç¬…æ¯å åœ #ä¼ ç»Ÿæ–‡åŒ–'
    ],
    divination: [
      'ç”¨å¤©ç„Webè¿›è¡Œäº†ç„é€‰ä¸¤éš¾åˆ†æï¼Œæ˜“ç»çš„æ™ºæ…§çœŸçš„å¾ˆæ·±åˆ»ï¼ğŸ“– #ç„é€‰ä¸¤éš¾ #æ˜“ç»æ™ºæ…§',
      'åœ¨ä¸¤éš¾é€‰æ‹©ä¸­å¾—åˆ°äº†æ˜“ç»çš„æŒ‡å¼•ï¼Œæ–¹å‘æ›´æ¸…æ™°äº† âœ¨ #æ˜“ç» #äººç”Ÿé€‰æ‹©',
      'é€šè¿‡æ˜“ç»å åœè§£å†³äº†å›°æ‰°å·²ä¹…çš„é—®é¢˜ ğŸŒŸ #æ˜“ç»å åœ #æ™ºæ…§æŒ‡å¼•'
    ]
  }
};

// ç¤¾äº¤å¹³å°é…ç½®
export const SOCIAL_PLATFORMS: SocialPlatform[] = [
  {
    name: 'å¾®ä¿¡',
    color: '#07C160',
    icon: {
      template: `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M8.691 2.188C3.891 2.188 0 5.476 0 9.53c0 2.212 1.162 4.203 2.985 5.55l-.666 3.015 3.315-1.65c.840.157 1.726.264 2.691.264.216 0 .431-.008.645-.024-.137-.464-.21-.957-.21-1.467 0-3.264 2.723-5.918 6.115-5.918.846 0 1.674.174 2.445.492C16.955 5.886 13.531 2.188 8.691 2.188zm-2.362 2.769c.496 0 .898.402.898.898s-.402.898-.898.898-.898-.402-.898-.898.402-.898.898-.898zm4.724 0c.496 0 .898.402.898.898s-.402.898-.898.898-.898-.402-.898-.898.402-.898.898-.898z"/><path d="M17.297 11.113c-3.069 0-5.568 2.036-5.568 4.542 0 1.613 1.027 3.041 2.569 3.926l-.57 2.184 2.427-1.206c.681.122 1.39.203 2.142.203 3.069 0 5.568-2.036 5.568-4.542s-2.499-4.542-5.568-4.542zm-1.774 1.816c.345 0 .625.28.625.625s-.28.625-.625.625-.625-.28-.625-.625.28-.625.625-.625zm3.548 0c.345 0 .625.28.625.625s-.28.625-.625.625-.625-.28-.625-.625.28-.625.625-.625z"/></svg>`
    },
    shareUrl: () => '' // å¾®ä¿¡éœ€è¦ç‰¹æ®Šå¤„ç†
  },
  {
    name: 'å¾®åš',
    color: '#E6162D',
    icon: {
      template: `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M10.098 20.323c-3.977.391-7.414-1.406-7.672-4.02-.259-2.609 2.759-5.047 6.74-5.441 3.979-.394 7.413 1.404 7.671 4.018.259 2.6-2.759 5.049-6.739 5.443zm8.717-8.922c-.332-.062-.559-.134-.385-.482.377-.753.416-1.403.115-1.868-.564-.871-2.116-.823-3.898-.026 0 0-.56.252-.416-.205.275-1.217.233-2.237-.249-2.824-1.089-1.331-3.991.052-6.479 3.081-1.858 2.267-2.937 4.665-2.937 6.74 0 3.959 4.869 6.364 9.635 6.364 6.255 0 10.426-3.74 10.426-6.709-.002-1.78-1.45-2.794-2.812-3.071z"/></svg>`
    },
    shareUrl: (data) => `https://service.weibo.com/share/share.php?title=${encodeURIComponent(data.text || '')}&url=${encodeURIComponent(data.url || window.location.href)}`
  },
  {
    name: 'QQç©ºé—´',
    color: '#12B7F5',
    icon: {
      template: `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12.017 0C5.396 0 .029 5.367.029 11.987c0 5.079 3.158 9.417 7.618 11.174-.105-.95-.199-2.405.042-3.441.219-.937 1.404-5.958 1.404-5.958s-.359-.719-.359-1.781c0-1.668.967-2.914 2.171-2.914 1.023 0 1.518.769 1.518 1.688 0 1.029-.655 2.568-.994 3.995-.283 1.194.599 2.169 1.777 2.169 2.133 0 3.772-2.249 3.772-5.495 0-2.873-2.064-4.882-5.012-4.882-3.414 0-5.418 2.561-5.418 5.207 0 1.031.397 2.138.893 2.738.098.119.112.224.083.345l-.333 1.36c-.053.22-.174.267-.402.161-1.499-.698-2.436-2.888-2.436-4.649 0-3.785 2.75-7.262 7.929-7.262 4.163 0 7.398 2.967 7.398 6.931 0 4.136-2.607 7.464-6.227 7.464-1.216 0-2.357-.631-2.747-1.378l-.748 2.853c-.271 1.043-1.002 2.35-1.492 3.146C9.57 23.812 10.763 24.009 12.017 24.009c6.624 0 11.99-5.367 11.99-11.988C24.007 5.367 18.641.001 12.017.001z"/></svg>`
    },
    shareUrl: (data) => `https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?title=${encodeURIComponent(data.title || '')}&desc=${encodeURIComponent(data.text || '')}&url=${encodeURIComponent(data.url || window.location.href)}`
  },
  {
    name: 'å°çº¢ä¹¦',
    color: '#FF2442',
    icon: {
      template: `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>`
    },
    shareUrl: () => '' // å°çº¢ä¹¦éœ€è¦ç‰¹æ®Šå¤„ç†
  }
];

/**
 * ç”Ÿæˆåˆ†äº«æ–‡æ¡ˆ
 */
export function generateShareCaption(type: ShareContentType, customText?: string): string {
  if (customText) return customText;
  
  const templates = DEFAULT_SHARE_CONFIG.captionTemplates[type];
  return templates[Math.floor(Math.random() * templates.length)];
}

/**
 * ç”Ÿæˆåˆ†äº«æ•°æ®
 */
export function createShareData(content: ShareContent): ShareData {
  return {
    title: content.title,
    text: content.generateCaption(),
    url: window.location.href,
    hashtags: [...content.hashtags, ...DEFAULT_SHARE_CONFIG.defaultHashtags]
  };
}

/**
 * å¤åˆ¶æ–‡æœ¬åˆ°å‰ªè´´æ¿
 */
export async function copyToClipboard(text: string): Promise<boolean> {
  try {
    await navigator.clipboard.writeText(text);
    return true;
  } catch (error) {
    console.error('å¤åˆ¶å¤±è´¥:', error);
    return false;
  }
}

/**
 * æ£€æŸ¥æ˜¯å¦æ”¯æŒåŸç”Ÿåˆ†äº«
 */
export function canUseNativeShare(): boolean {
  return typeof navigator !== 'undefined' && !!navigator.share;
}

/**
 * åˆ†äº«åˆ°ç¤¾äº¤å¹³å°
 */
export function shareToSocialPlatform(platform: SocialPlatform, data: ShareData): void {
  if (platform.name === 'å¾®ä¿¡') {
    alert('è¯·é•¿æŒ‰å›¾ç‰‡ä¿å­˜ï¼Œç„¶ååœ¨å¾®ä¿¡ä¸­å‘é€');
    return;
  }

  if (platform.name === 'å°çº¢ä¹¦') {
    alert('è¯·ä¿å­˜å›¾ç‰‡ååœ¨å°çº¢ä¹¦APPä¸­å‘å¸ƒ');
    return;
  }

  const shareUrl = platform.shareUrl(data);
  if (shareUrl) {
    window.open(shareUrl, '_blank', 'width=600,height=400');
  }
}

/**
 * åŸç”Ÿåˆ†äº«
 */
export async function nativeShare(data: ShareData, imageFile?: File): Promise<boolean> {
  if (!canUseNativeShare()) {
    return false;
  }

  try {
    const shareData: any = {
      title: data.title,
      text: data.text,
      url: data.url
    };

    if (imageFile) {
      shareData.files = [imageFile];
    }

    await navigator.share(shareData);
    return true;
  } catch (error) {
    console.error('åŸç”Ÿåˆ†äº«å¤±è´¥:', error);
    return false;
  }
} 