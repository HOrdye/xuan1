# Decision Log

- [2025-05-12 15:03:00] - Decision to create memory-bank directory and initialize core files for context tracking and project management.
- [2024-06-04 10:00:00] - 决定采用"用户参与+时间混合法"生成卦象，提升占卜真实感和仪式感；解卦部分融合本地六十四卦卦辞、变卦、爻辞与LLM（大模型）智能建议，确保建议有逻辑、有可信度且个性化。具体技术方案如下：

## 技术方案概要

### 1. 卦象生成
- 收集用户输入（问题、选项、生日）、当前时间、用户操作行为（如点击时长、顺序等）
- 拼接所有数据，哈希为整数种子
- 用种子驱动伪随机数生成器，模拟铜钱法概率生成六爻
- 过程可动画展示，增强仪式感

### 2. 智能解卦
- 本地查找本卦、变卦、爻辞等基础数据，结构化输出
- 组装结构化prompt，调用LLM（如DeepSeek、OpenAI）API，要求结合卦辞、变卦、用户问题输出有逻辑、有依据的建议
- UI分区展示"传统卦辞解读"与"AI大师建议"，提升可信度
- 若LLM不可用，自动用本地模板+卦辞+爻辞拼接生成建议，保证体验不中断

### 3. 其他
- 本地完善六十四卦卦辞、象辞、爻辞数据库
- 前端/后端分工明确，API接口标准化
- 用户引导与可信度提示优化

## 近期决策

### 笅杯占卜功能优化
- [2024-06-10 14:30:00] - 决定使用Anime.js的高级特性实现笅杯动画，包括：
  - 使用物理引擎模拟笅杯的运动轨迹
  - 添加碰撞检测和反弹效果
  - 实现更真实的落地动画
  - 优化动画性能，确保在低端设备上的流畅运行

### 今日运势模块改进
- [2024-06-10 14:30:00] - 决定优化运势生成算法，包括：
  - 结合用户生日信息生成个性化运势
  - 增加运势分项（事业、财运、健康等）
  - 添加宜忌事项建议
  - 实现运势历史记录功能

### UI/UX优化
- [2024-06-10 14:30:00] - 决定统一设计语言，包括：
  - 建立统一的设计系统
  - 优化动画和过渡效果
  - 改进移动端适配
  - 增加结果分享功能

### 保存与分享功能架构
- [2024-06-11 10:00:00] - 决定为"保存与分享"功能采用"混合数据源与抽象层"架构。该决策旨在确保当前基于本地存储的实现能够平滑过渡到未来包含用户账户系统的云端存储架构，避免大规模重构。
  - **核心组件**:
    - **HistoryService**: 创建一个独立的服务层 `src/services/historyService.ts`，用于封装所有数据持久化逻辑（当前为LocalStorage，未来可扩展为API调用）。
    - **HistoryStore**: Pinia Store (`src/store/historyStore.ts`) 作为运行时的数据缓存和UI响应触发器，其数据读写将通过 `HistoryService` 完成，实现业务逻辑与数据源的解耦。
  - **分享机制**:
    - **核心流程**: 将"分享"升级为"生成专属分享图"，使用 `html2canvas` 库将DOM渲染为图片，提升社交传播价值。
    - **技术方案**: 优先使用Web Share API，并为桌面端提供"下载图片"的备选方案。

### 分享功能全面优化架构决策
- [2024-12-27 16:00:00] - 决定采用"渐进式优化"方案全面提升分享功能体验和覆盖范围。该决策基于用户反馈和项目发展需要，旨在构建统一、高效、用户友好的分享生态。
  - **技术架构决策**:
    - **统一分享服务**: 创建 `src/types/share.ts`, `src/utils/shareUtils.ts`, `src/composables/useShare.ts` 三层架构
    - **模块化设计**: 各占卜模块实现统一的分享接口，确保一致性和可维护性
    - **智能文案生成**: 集成LLM服务，基于占卜结果自动生成个性化分享文案
  - **社交媒体集成策略**:
    - **平台适配**: 针对微信、微博、QQ、小红书等主流平台优化分享尺寸和格式
    - **快捷分享**: 实现一键分享到各大社交平台的功能
    - **标签推荐**: 自动添加热门标签如 #今日运势 #塔罗占卜 提升传播效果
  - **实施阶段**:
    - **第一阶段**: 优化现有SharePanel组件，添加社交媒体按钮和智能文案
    - **第二阶段**: 为所有7个占卜模块集成分享功能
    - **第三阶段**: 实现个性化分享模板和深度社交集成
  - **技术原则**:
    - 保持现有代码架构不变，采用扩展而非重构的方式
    - 确保异步处理和多并发支持，提升企业级运行能力
    - 扁平化设计，避免多层嵌套，保持代码简洁高效

### 分享功能全面优化实施成果
- [2024-12-27 17:00:00] - 成功完成分享功能全面优化项目的第一和第二阶段，实现了统一、高效、用户友好的分享生态系统。
  - **第一阶段成果（基础优化）**:
    - **SharePanel组件重构**: 添加了微信、微博、QQ空间、小红书四大社交媒体分享按钮
    - **智能文案生成**: 实现了基于占卜类型的个性化分享文案自动生成
    - **图片生成优化**: 改进了html2canvas配置，提升分享图片质量和兼容性
  - **第二阶段成果（模块集成）**:
    - **全模块覆盖**: 成功为塔罗、笅杯、玄选两难、今日运势四大模块集成分享功能
    - **统一架构**: 创建了完整的三层架构（types/share.ts、utils/shareUtils.ts、composables/useShare.ts）
    - **类型安全**: 实现了完整的TypeScript类型定义，确保类型安全和开发体验
  - **技术架构优势**:
    - **模块化设计**: 每个模块可独立使用分享功能，互不干扰
    - **可扩展性**: 新增社交平台或分享类型只需修改配置文件
    - **一致性**: 所有模块使用统一的分享接口和用户体验
    - **性能优化**: 异步处理和智能文案生成，支持高并发访问
  - **用户体验提升**:
    - **一键分享**: 支持系统原生分享API和社交媒体快捷分享
    - **个性化文案**: 根据占卜类型自动生成合适的分享文案
    - **视觉优化**: 分享图片质量提升，适配不同平台尺寸要求
    - **操作简化**: 统一的操作流程，降低用户学习成本

# 天玄Web项目决策日志

## 塔罗分享内容个性化优化 (2024-12-27)

### 问题描述
用户反馈塔罗分享功能的内容过于简单，缺乏个性化特点，应该包含：
- 卡牌信息（名称、正逆位）
- 各框体的核心语句
- 具有建设性的解读

### 决策过程
经过分析，决定采用Level 2增强方案：
1. **数据提取策略**：从现有的`revealedCards`和`mainInterpretation`中提取关键信息
2. **内容生成逻辑**：创建智能算法提取核心洞察和建设性建议
3. **用户体验优化**：确保分享内容既有个性又有指导意义

### 实现方案
#### 1. 核心功能实现
- **tarotShareData计算属性**：动态生成个性化分享内容
- **智能内容提取**：
  - 卡牌信息：名称 + 正逆位状态
  - 核心洞察：从解读摘要中筛选15-120字的精华内容
  - 建设性建议：使用正则表达式匹配指导性语句
  - 用户问题：包含原始咨询问题（如果有）

#### 2. 内容质量保证
- **长度控制**：确保分享内容长度适中，适合社交媒体
- **格式化处理**：清理多余符号，确保句子完整性
- **边界情况处理**：无解读数据时提供默认内容

#### 3. 分享模板优化
更新shareUtils.ts中的塔罗分享模板，强调：
- 卡牌象征意义
- 个人成长价值
- 建设性指导意义

### 技术细节
```typescript
// 核心实现逻辑
const tarotShareData = computed(() => {
  // 1. 提取卡牌信息
  const cardNames = revealedCards.value.map(card => 
    `${card.name}(${card.orientation === 'reversed' ? '逆位' : '正位'})`
  ).join('、');
  
  // 2. 提取核心洞察
  const keyInsights = mainInterpretation.value
    .filter(section => section.title && section.summary)
    .map(section => formatSummary(section.summary))
    .filter(insight => insight.length > 15 && insight.length < 120)
    .slice(0, 2);
  
  // 3. 提取建设性建议
  const constructiveAdvice = extractAdvice(mainInterpretation.value);
  
  // 4. 生成分享文案
  return generateShareText(cardNames, keyInsights, constructiveAdvice);
});
```

### 预期效果
- **个性化程度**：每次分享都包含具体的卡牌信息和解读内容
- **指导价值**：提供具体的建设性建议，不仅是娱乐
- **社交传播**：内容更有意义，更容易引起共鸣和分享

### 测试验证
- 功能测试：确保各种牌阵和解读情况下都能正确生成内容
- 内容质量：验证提取的洞察和建议确实有价值
- 边界情况：处理无解读数据、空问题等情况

### 后续优化方向
1. 根据用户反馈调整内容提取算法
2. 增加更多个性化元素（如用户偏好）
3. 优化分享图片生成，包含更多视觉元素

---

## 分享功能全面优化项目 (2024-12-27)
