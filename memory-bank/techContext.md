# 天玄 Web 技术上下文

## 项目技术架构

天玄 Web 采用了现代化的前端技术栈，主要包括：

- **Vue 3**：采用组合式API（Composition API）作为主要开发范式
- **TypeScript**：用于类型安全和开发体验提升
- **Vite**：作为构建工具，提供快速的开发体验
- **Tailwind CSS**：用于样式开发，采用实用优先的CSS框架
- **Pinia**：用于状态管理，替代Vuex，提供更好的TypeScript支持
- **Vue Router**：用于前端路由管理
- **Anime.js**：用于页面动画效果
- **Naive UI**：作为UI组件库辅助开发

## 核心功能技术实现

### 1. 六十四卦系统

六十四卦系统是项目的核心功能之一，主要包括以下技术实现：

#### 数据结构
```typescript
interface Hexagram {
  sequence: number;         // 序号
  name: string;             // 名称
  chineseName: string;      // 中文名
  symbol: string;           // 符号
  lines: number[];          // 爻线（0表示阴爻，1表示阳爻）
  nature: string;           // 性质
  element: string;          // 五行属性
  meaning: string;          // 含义
  interpretation: string;   // 解释
  image?: string;           // 图像URL
}
```

#### 关键算法
1. **卦象生成算法**：
   - 铜钱占卜法：模拟三枚铜钱的投掷，根据正反面组合生成爻
   - 梅花易数法：基于用户输入的数字或时间计算卦象
   - 随机起卦法：使用随机数生成器直接生成六爻

2. **变爻算法**：
   - 根据特定条件（如动爻）计算本卦到变卦的转换

3. **卦象解读算法**：
   - 基于卦象的整体、爻的位置和变化生成解读文本

#### 实现文件
- `src/composables/useHexagram.ts`：六十四卦相关的组合式API
- `src/features/divination/services/hexagramService.ts`：卦象服务
- `src/components/hexagram/HexagramDisplay.vue`：卦象显示组件

### 2. 玄选两难系统

玄选两难是项目的另一个核心功能，用于帮助用户在两个选择中做出决策。

#### 数据流
1. 用户输入两个选项（A和B）
2. 系统根据选项的文本特征生成卦象
3. 系统分析卦象并生成针对两个选项的分析结果
4. 系统给出推荐选择和匹配度评分

#### 关键算法
1. **选项分析算法**：
   - 基于卦象的属性（如五行、卦辞、爻辞）分析选项的潜在结果
   - 计算选项与卦象的匹配度得分

2. **推荐决策算法**：
   - 综合考虑卦象、变爻和用户选项，给出最终推荐

#### 实现文件
- `src/features/dilemma/views/DilemmaPage.vue`：玄选两难主页
- `src/features/dilemma/views/HexagramTester.vue`：两难测试页面
- `src/features/dilemma/services/dilemmaService.ts`：两难分析服务

### 3. 卦象浏览器

卦象浏览器允许用户浏览所有六十四卦的详细信息。

#### 功能特点
1. 支持按卦名、五行属性等进行筛选和搜索
2. 提供卦象的完整解读和图示
3. 支持随机选择卦象功能

#### 技术实现
- 采用Grid布局展示卦象列表
- 使用Vue的计算属性实现筛选功能
- 结合Anime.js实现平滑的切换动画

#### 实现文件
- `src/views/HexagramExplorer.vue`：卦象浏览器主组件

## 状态管理设计

项目使用Pinia进行状态管理，主要包括以下几个store：

### 1. Hexagram Store
管理六十四卦数据和相关状态，包括：
- 卦象数据的加载和缓存
- 当前选中的卦象
- 占卜历史记录

### 2. User Store
管理用户相关状态，包括：
- 用户偏好设置
- 用户历史记录
- 收藏内容

### 3. UI Store
管理UI相关状态，包括：
- 主题设置
- 动画开关
- 全局加载状态

## 组件设计原则

项目采用以下组件设计原则：

1. **职责单一原则**：每个组件只负责一个功能
2. **组合式设计**：使用Vue 3的组合式API抽取可复用逻辑
3. **原子化设计**：构建小型、可复用的UI组件
4. **一致性**：保持组件API和样式的一致性

## 动画系统

项目使用Anime.js作为主要动画库，实现以下效果：

1. **页面过渡动画**：页面切换时的平滑过渡
2. **交互反馈动画**：按钮点击、表单提交等交互的视觉反馈
3. **卦象动画**：卦象生成和变化的动态效果
4. **占卜仪式动画**：铜钱投掷、笅杯等占卜方式的动画效果

## 待实现功能技术规划

### 1. 今日运势模块

计划使用以下技术实现：
- 基于日期和用户生日的运势算法
- 与六十四卦系统的集成
- 基于卦象属性的运势分类和建议生成

### 2. 笅杯占卜功能

计划使用以下技术实现：
- 使用Anime.js或Lottie实现笅杯投掷动画
- 基于物理引擎模拟笅杯的运动轨迹
- 笅杯结果的概率分布和解读系统

### 3. 视觉分析网络

计划使用以下技术实现：
- 使用D3.js或ECharts实现数据可视化
- 卦象关系的力导向图
- 交互式筛选和探索功能

## 性能优化策略

项目采用以下性能优化策略：

1. **代码分割**：通过路由懒加载减小初始加载体积
2. **资源预加载**：预加载关键资源，如卦象数据
3. **缓存策略**：本地缓存频繁使用的数据
4. **图片优化**：使用适当的图片格式和大小
5. **计算属性缓存**：利用Vue的计算属性缓存复杂计算结果

## 开发指南

### 1. 组件开发规范
- 组件名采用PascalCase命名
- 组件文件与组件名保持一致
- props定义明确的类型和默认值
- 提供明确的事件文档

### 2. API调用规范
- 所有API调用集中在services目录下
- 使用统一的错误处理机制
- 提供加载状态和错误状态的处理

### 3. 状态管理规范
- 局部状态使用组件的ref/reactive
- 共享状态使用Pinia store
- 持久化数据通过pinia-plugin-persistedstate实现

## 技术栈概览

### 前端核心
- **框架**: Vue.js 3 (使用Composition API)
- **构建工具**: Vite
- **类型系统**: TypeScript
- **状态管理**: Pinia + pinia-plugin-persistedstate（用于状态持久化）
- **路由**: Vue Router 4

### UI/UX
- **组件库**: Naive UI
- **样式解决方案**: Tailwind CSS
- **动画库**: 
  - Anime.js (主要用于复杂交互动画)
  - Lottie-web (用于预设动画)
- **图标**: 内置Naive UI图标 + 自定义SVG图标

### 后端/存储
- **BaaS**: Supabase (计划中)
  - 数据存储
  - 用户认证
  - 云函数
- **客户端API**: @supabase/supabase-js
- **HTTP客户端**: Axios (用于第三方API调用)

### 工具与实用程序
- **工具库**: @vueuse/core (Vue组合式API工具集)
- **格式化/检查**: ESLint + TypeScript ESLint

## 项目结构

```
src/
├── assets/           # 静态资源(图片、字体等)
├── components/       # 共享组件
├── composables/      # 可复用的组合式函数
├── core/             # 核心功能和配置
├── features/         # 功能模块
│   ├── divination/   # 占卜功能
│   ├── dilemma/      # 两难选择功能
│   ├── fortune/      # 运势功能
│   ├── jiao-bei/     # 笅杯功能
│   ├── tarot/        # 塔罗功能
│   └── van/          # Van（杂项功能）
├── router/           # 路由配置
├── services/         # 服务层(API调用等)
├── shared/           # 共享资源和工具
├── store/            # Pinia全局状态
├── utils/            # 工具函数
├── views/            # 页面视图
├── App.vue           # 根组件
├── env.d.ts          # 环境变量类型定义
└── main.ts           # 应用入口
```

## 关键技术实现

### 1. 卦象生成系统
- 基于`hexagrams.json`文件中的64卦数据
- 使用不同算法实现卦象生成:
  - 字符特征算法 (用于选择题分析)
  - 随机算法 (用于随机起卦)
  - 模拟铜钱算法 (用于铜钱占卜)
  - 数字算法 (用于梅花易数)

### 2. 动画系统
- 使用Anime.js实现交互式动画
  - 卦象变换动画
  - 占卜过程动画
  - 笅杯模拟动画 (计划中)
- 使用CSS动画实现简单UI交互

### 3. 数据持久化
- 使用Pinia作为状态管理
- 通过pinia-plugin-persistedstate实现本地存储
- 计划通过Supabase实现云端存储

### 4. 响应式设计
- 使用Tailwind CSS的响应式类
- 媒体查询适配不同设备尺寸
- 使用Vue的响应式API管理状态变化

## 技术债务和优化点

### 性能优化
- [ ] 实现组件懒加载
- [ ] 优化大型JSON数据处理
- [ ] 添加资源预加载策略

### 代码质量
- [ ] 完善TypeScript类型定义
- [ ] 提高单元测试覆盖率
- [ ] 优化组件复用性

### 架构改进
- [ ] 实现更严格的模块边界
- [ ] 优化状态管理结构
- [ ] 提取更多可复用composables

## API集成计划

### 1. Supabase集成
- 用户数据存储
- 历史记录和收藏功能
- 用户认证系统

### 2. DeepSeek AI集成
- 智能解读生成
- 塔罗牌解读
- 解梦功能

## 技术实现路线图

### 近期优先实现
1. 完成笅杯占卜功能的动画实现
2. 开发今日运势模块基础算法
3. 优化现有占卜系统的交互体验

### 中期计划
1. 实现用户数据持久化存储
2. 开发玄学画像系统基础功能
3. 实现DIY开运潮物的前端交互

### 长期计划
1. 集成AI功能
2. 实现社区互动功能
3. 开发游戏化系统 